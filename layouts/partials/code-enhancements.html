<!-- Simplified Light Theme Code Blocks - LLVM Style Compatible -->
<style>
/* 코드블록 컨테이너 - 흰색 테마 */
.code-container {
  background: #ffffff;
  border: 1px solid #d0d0d0;
  border-radius: 4px;
  margin: 1.5rem 0;
  overflow: hidden;
  font-family: 'Fira Code', 'SF Mono', Consolas, 'Liberation Mono', Menlo, monospace;
  position: relative;
}

/* Hugo highlight 구조 스타일링 */
.highlight {
  background: #fafafa !important;
  margin: 0;
  position: relative;
}

/* 줄 번호 테이블 구조 */
.highlight .lntable {
  border-spacing: 0;
  padding: 0;
  margin: 0;
  border: 0;
  width: 100%;
  overflow: auto;
  display: block;
  background: #fafafa;
}

.highlight .lntable tbody {
  display: table;
  width: 100%;
}

.highlight .lntable tr {
  display: table-row;
}

.highlight .lntable .lntd {
  vertical-align: top;
  padding: 0;
  margin: 0;
  border: 0;
}

/* 줄 번호 컬럼 */
.highlight .lntable .lntd:first-child {
  min-width: 50px;
  border-right: 1px solid #e0e0e0;
  background: #f5f5f5;
  user-select: none;
  padding: 0;
}

.highlight .lntable .lntd:first-child pre {
  margin: 0;
  padding: 16px 12px;
  background: transparent;
  text-align: right;
  color: #999999;
  font-size: 14px;
  line-height: 21px;
}

/* 코드 내용 컬럼 */
.highlight .lntable .lntd:last-child {
  width: 100%;
  padding: 0;
}

.highlight .lntable .lntd:last-child pre {
  margin: 0;
  padding: 16px;
  background: transparent;
  overflow-x: auto;
  color: #333333;
  font-size: 14px;
  line-height: 21px;
  white-space: pre;
}

/* 줄 번호 스타일 */
.highlight .lnt {
  display: inline-block;
  color: #999999;
  font-weight: normal;
}

/* 코드 라인 - 줄바꿈 유지 */
.highlight .line {
  display: block;
  min-height: 21px;
  line-height: 21px;
}

/* 복사 버튼 - 우측 상단에 배치 */
.code-copy-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: #f0f0f0;
  border: 1px solid #d0d0d0;
  color: #333333;
  padding: 4px 10px;
  border-radius: 3px;
  font-size: 12px;
  cursor: pointer;
  opacity: 0;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 4px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
  height: 24px;
  z-index: 10;
}

.highlight:hover .code-copy-btn {
  opacity: 1;
}

.code-copy-btn:hover {
  background: #e0e0e0;
  border-color: #b0b0b0;
}

.code-copy-btn:active {
  background: #d0d0d0;
}

.code-copy-btn.clicked {
  background: #e8f5e9;
  border-color: #4caf50;
  color: #2e7d32;
}

.code-copy-btn svg {
  width: 12px;
  height: 12px;
}

/* Chroma 신택스 하이라이팅 - 라이트 테마 */
.highlight .k,
.highlight .kd,
.highlight .kn,
.highlight .kp,
.highlight .kr,
.highlight .kt { color: #0000ff !important; font-weight: bold; }  /* 키워드: 파란색 */

.highlight .s,
.highlight .s1,
.highlight .s2,
.highlight .sa,
.highlight .sb,
.highlight .sc,
.highlight .dl,
.highlight .sd,
.highlight .se,
.highlight .sh,
.highlight .si,
.highlight .sx,
.highlight .sr,
.highlight .ss { color: #a31515 !important; }  /* 문자열: 빨간색 */

.highlight .c,
.highlight .c1,
.highlight .cm,
.highlight .cp,
.highlight .cs,
.highlight .ch { color: #008000 !important; font-style: italic; }  /* 주석: 초록색 */

.highlight .m,
.highlight .mb,
.highlight .mf,
.highlight .mh,
.highlight .mi,
.highlight .mo,
.highlight .il { color: #098658 !important; }  /* 숫자: 진한 초록 */

.highlight .n,
.highlight .na,
.highlight .nb,
.highlight .nc,
.highlight .nd,
.highlight .ne,
.highlight .nf,
.highlight .ni,
.highlight .nl,
.highlight .nn,
.highlight .no,
.highlight .nt,
.highlight .nv,
.highlight .nx,
.highlight .py,
.highlight .w { color: #333333 !important; }  /* 식별자: 검은색 */

.highlight .nc,
.highlight .nn { color: #267f99 !important; }  /* 클래스/네임스페이스: 청록색 */

.highlight .nf { color: #795e26 !important; }  /* 함수: 갈색 */

.highlight .kc,
.highlight .bp { color: #0000ff !important; }  /* 상수/내장: 파란색 */

.highlight .o,
.highlight .ow { color: #333333 !important; }  /* 연산자: 검은색 */

.highlight .p,
.highlight .pi { color: #333333 !important; }  /* 구두점: 검은색 */

/* 인라인 코드 스타일 - 흰색 테마 */
code:not(.highlight code):not(pre code) {
  background: #f5f5f5;
  color: #666666;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.9em;
  font-family: 'Fira Code', 'SF Mono', Consolas, monospace;
  border: 1px solid #e0e0e0;
  font-weight: normal;
}

/* 스크롤바 스타일링 */
.highlight .lntd:last-child pre::-webkit-scrollbar {
  height: 8px;
}

.highlight .lntd:last-child pre::-webkit-scrollbar-track {
  background: #f0f0f0;
}

.highlight .lntd:last-child pre::-webkit-scrollbar-thumb {
  background: #c0c0c0;
  border-radius: 4px;
}

.highlight .lntd:last-child pre::-webkit-scrollbar-thumb:hover {
  background: #a0a0a0;
}

/* 반응형 디자인 */
@media (max-width: 768px) {
  .highlight .lntable .lntd:first-child {
    min-width: 40px;
  }

  .highlight .lntable .lntd:first-child pre,
  .highlight .lntable .lntd:last-child pre {
    padding: 12px;
    font-size: 13px;
  }

  .highlight .line {
    min-height: 18.85px;
    line-height: 18.85px;
  }

  .code-copy-btn {
    font-size: 11px;
    padding: 3px 8px;
    height: 22px;
  }
}

@media (max-width: 480px) {
  .highlight .lntable .lntd:first-child {
    min-width: 35px;
  }

  .highlight .lntable .lntd:first-child pre,
  .highlight .lntable .lntd:last-child pre {
    padding: 8px;
    font-size: 12px;
  }

  .highlight .line {
    min-height: 17.4px;
    line-height: 17.4px;
  }

  .code-copy-btn {
    font-size: 10px;
    padding: 2px 6px;
    height: 20px;
  }
}
</style>

<script>
class CodeEnhancer {
  constructor() {
    this.copyIcon = `<svg fill="currentColor" viewBox="0 0 16 16">
      <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
      <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
    </svg>`;

    this.checkIcon = `<svg fill="currentColor" viewBox="0 0 16 16">
      <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
    </svg>`;

    this.init();
  }

  init() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => this.enhanceAllCodeBlocks());
    } else {
      this.enhanceAllCodeBlocks();
    }

    // 동적으로 추가되는 코드블록 감지
    this.observeContentChanges();
  }

  observeContentChanges() {
    const observer = new MutationObserver((mutations) => {
      mutations.forEach(mutation => {
        if (mutation.type === 'childList') {
          mutation.addedNodes.forEach(node => {
            if (node.nodeType === Node.ELEMENT_NODE) {
              const newHighlights = node.querySelectorAll ? node.querySelectorAll('.highlight:not(.code-enhanced)') : [];
              newHighlights.forEach(block => this.enhanceCodeBlock(block));

              if (node.matches && node.matches('.highlight:not(.code-enhanced)')) {
                this.enhanceCodeBlock(node);
              }
            }
          });
        }
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  }

  enhanceAllCodeBlocks() {
    const highlightBlocks = document.querySelectorAll('.highlight:not(.code-enhanced)');
    highlightBlocks.forEach(block => this.enhanceCodeBlock(block));
  }

  enhanceCodeBlock(highlightElement) {
    if (highlightElement.classList.contains('code-enhanced')) {
      return;
    }

    const codeContent = this.extractCodeContent(highlightElement);

    if (!codeContent.trim()) {
      return;
    }

    highlightElement.classList.add('code-enhanced');

    // 복사 버튼 추가
    const copyBtn = this.createCopyButton(codeContent);
    highlightElement.appendChild(copyBtn);
  }

  extractCodeContent(highlightElement) {
    // Hugo의 lntable 구조에서 코드 내용 추출
    const codeElement = highlightElement.querySelector('.lntd:last-child code');
    if (codeElement) {
      return codeElement.textContent || codeElement.innerText || '';
    }

    // 일반적인 구조에서 추출
    const generalCode = highlightElement.querySelector('code');
    if (generalCode) {
      return generalCode.textContent || generalCode.innerText || '';
    }

    return '';
  }

  createCopyButton(codeContent) {
    const copyBtn = document.createElement('button');
    copyBtn.className = 'code-copy-btn';
    copyBtn.innerHTML = `${this.copyIcon} Copy`;
    copyBtn.title = 'Copy code';
    copyBtn.setAttribute('aria-label', 'Copy code to clipboard');

    copyBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      this.copyToClipboard(copyBtn, codeContent);
    });

    return copyBtn;
  }

  async copyToClipboard(button, text) {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        this.showCopyFeedback(button, true);
      } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        const successful = document.execCommand('copy');
        document.body.removeChild(textArea);

        this.showCopyFeedback(button, successful);
      }
    } catch (err) {
      console.error('Failed to copy:', err);
      this.showCopyFeedback(button, false);
    }
  }

  showCopyFeedback(button, success) {
    const originalHTML = button.innerHTML;

    if (success) {
      button.innerHTML = `${this.checkIcon} Copied!`;
      button.classList.add('clicked');

      setTimeout(() => {
        button.innerHTML = originalHTML;
        button.classList.remove('clicked');
      }, 2000);
    } else {
      button.innerHTML = `${this.copyIcon} Failed`;
      setTimeout(() => {
        button.innerHTML = originalHTML;
      }, 2000);
    }
  }
}

// Initialize enhancer
new CodeEnhancer();
</script>
