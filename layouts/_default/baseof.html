<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
                      "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} - {{ .Site.Title }}{{ end }}</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.subtitle }}{{ end }}">
  <meta name="author" content="{{ .Site.Params.author.name }}">
  <meta name="keywords" content="{{ if .Params.tags }}{{ delimit .Params.tags ", " }}{{ else if .Site.Params.keywords }}{{ delimit .Site.Params.keywords ", " }}{{ else }}프로그래밍, 개발, 기술블로그, Hugo, GitHub{{ end }}">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="{{ .Permalink }}">

  <!-- Schema.org for Google -->
  <meta itemprop="name" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  <meta itemprop="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.subtitle }}{{ end }}">
  {{ if .Params.featured_image }}<meta itemprop="image" content="{{ .Params.featured_image | absURL }}">{{ end }}

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.subtitle }}{{ end }}">
  <meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:site_name" content="{{ .Site.Title }}">
  <meta property="og:locale" content="ko_KR">
  {{ if .Params.featured_image }}<meta property="og:image" content="{{ .Params.featured_image | absURL }}">{{ end }}
  {{ if .Date }}<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">{{ end }}
  {{ if .Lastmod }}<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">{{ end }}
  {{ with .Params.tags }}{{ range . }}<meta property="article:tag" content="{{ . }}">{{ end }}{{ end }}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.subtitle }}{{ end }}">
  {{ if .Params.featured_image }}<meta name="twitter:image" content="{{ .Params.featured_image | absURL }}">{{ end }}

  <!-- Favicon -->
  <link rel="icon" type="image/gif" href="https://minecraft.wiki/images/Enchanted_Stone_Shovel.gif?33e82">

  <!-- RSS Feed -->
  {{ with .OutputFormats.Get "RSS" }}
    <link href="{{ .Permalink }}" rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}">
  {{ end }}

  <!-- JSON Feed for Search -->
  {{ with .OutputFormats.Get "JSON" }}
    <link href="{{ .Permalink }}" rel="alternate" type="application/json" title="{{ $.Site.Title }} Search Index">
  {{ end }}

  <!-- Google Fonts for Code -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{{ if .IsHome }}WebSite{{ else }}{{ if eq .Type "posts" }}BlogPosting{{ else }}WebPage{{ end }}{{ end }}",
    "name": "{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}",
    "headline": "{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}",
    "description": "{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.subtitle }}{{ end }}",
    "url": "{{ .Permalink }}",
    {{ if .IsHome }}
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ .Site.BaseURL }}search/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    {{ end }}
    {{ if eq .Type "posts" }}
    "author": {
      "@type": "Person",
      "name": "{{ .Site.Params.author.name }}",
      "url": "{{ .Site.BaseURL }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ .Site.Title }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ .Site.Params.author.avatar | absURL }}"
      }
    },
    "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
    "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
    {{ if .Params.featured_image }}
    "image": "{{ .Params.featured_image | absURL }}",
    {{ end }}
    {{ if .Params.tags }}
    "keywords": [{{ range $i, $tag := .Params.tags }}{{ if $i }}, {{ end }}"{{ $tag }}"{{ end }}],
    {{ end }}
    {{ end }}
    "inLanguage": "ko-KR",
    "isPartOf": {
      "@type": "WebSite",
      "name": "{{ .Site.Title }}",
      "url": "{{ .Site.BaseURL }}"
    }
  }
  </script>

  <!-- Google Search Console Verification -->
  {{ with .Site.Params.googleSiteVerification }}
  <meta name="google-site-verification" content="{{ . }}">
  {{ end }}

  <!-- Google Analytics -->
  {{ with .Site.Params.googleAnalytics }}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ . }}');
  </script>
  {{ end }}

  <!-- Include theme variables -->
  {{ partial "theme-vars.html" . }}
</head>
<body>
  {{ partial "header.html" . }}

  <!-- LLVM 스타일 Table 레이아웃: 좌측 + 중앙 + 우측 3열 -->
  <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
      <!-- 좌측 네비게이션 -->
      <td valign="top" align="center" style="width: 220px;">
        {{ partial "sidebar.html" . }}
      </td>

      <!-- 중앙 본문 -->
      <td valign="top" class="main-content">
        {{ block "main" . }}{{ end }}
      </td>

      <!-- 우측 프로필/TOC -->
      <td valign="top" align="center" style="width: 250px;">
        {{ partial "sidebar-right.html" . }}
      </td>
    </tr>
   </table>

  <!-- Search Modal -->
  {{ partial "search.html" . }}

  <!-- URL Preview -->
  {{ partial "url-preview.html" . }}

  <!-- Code Enhancements -->
  {{ partial "code-enhancements.html" . }}

  <!-- URL Preview Configuration -->
  <script src="/js/url-preview-config.js"></script>

  <!-- Mermaid Diagrams -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        securityLevel: 'loose',
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true
        }
      });
    });
  </script>

  <!-- Load search scripts -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 키보드 단축키: Ctrl+K 또는 Cmd+K로 헤더 검색창 포커스
      document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          const headerSearchInput = document.getElementById('header-search-input');
          if (headerSearchInput) {
            headerSearchInput.focus();
            // 검색창이 보이도록 스크롤
            headerSearchInput.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }
        }
      });
    });
  </script>

  <!-- 반응형 스타일 -->
  <style>
  *, *::before, *::after {
    box-sizing: border-box;
  }

  html {
    margin: 0;
    padding: 0;
    width: 100%;
    overflow-x: clip;
  }

  body {
    margin: 0;
    padding: 0;
    width: 100%;
    max-width: 100%;
    position: relative;
  }

  /* 모바일용 프로필 섹션 (완전 숨김) */
  .mobile-profile {
    display: none;
  }

  /* 데스크톱 */
  @media (min-width: 1025px) {
    table {
      max-width: 1400px;
      margin: 0 auto;
      display: table;
    }

    table tbody {
      display: table-row-group;
    }

    table tr {
      display: table-row;
    }

    table td {
      display: table-cell;
    }

    table td:first-child {
      display: table-cell;
      width: 220px;
    }

    table td:nth-child(2) {
      width: auto;
      max-width: 900px;
    }

    table td:nth-child(3) {
      display: table-cell;
      width: 250px;
      position: static;
      z-index: 2;
    }
  }

  /* 태블릿 */
  @media (min-width: 769px) and (max-width: 1024px) {
    table {
      max-width: 100%;
      display: table;
    }

    table tbody {
      display: table-row-group;
    }

    table tr {
      display: table-row;
    }

    table td {
      display: table-cell;
    }

    table td:first-child {
      display: table-cell;
      width: 200px;
    }

    table td:nth-child(2) {
      width: auto;
    }

    table td:nth-child(3) {
      display: table-cell;
      width: 220px;
    }
  }

  /* 모바일 */
  @media (max-width: 768px) {
    table {
      display: block;
      max-width: 100%;
      width: 100%;
      overflow-x: hidden;
    }

    table tbody {
      display: block;
    }

    table tr {
      display: block;
    }

    table td:first-child {
      display: none;
    }

    table td:nth-child(2) {
      display: block;
      width: 100% !important;
      max-width: 100%;
      padding: 10px;
      overflow-x: hidden;
    }

    table td:nth-child(3) {
      display: none;
    }

    /* 중첩된 테이블도 모바일에 맞게 조정 */
    .main-content table {
      display: block !important;
      width: 100% !important;
      max-width: 100% !important;
      overflow-x: auto !important;
    }

    .main-content table tbody {
      display: block !important;
    }

    .main-content table tr {
      display: block !important;
    }

    .main-content table td {
      display: block !important;
      width: 100% !important;
      padding: 10px !important;
    }

    body {
      padding: 0;
      width: 100%;
      max-width: 100%;
    }

    /* 모바일에서 우측 사이드바를 본문 하단에 추가 (홈 페이지 제외) */
    .mobile-profile {
      display: block;
      margin-top: 2rem;
      padding: 1rem;
      border: 2px solid #CCCCCC;
    }
  }
  </style>
</body>
</html>
