name: Deploy Hugo to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0  # Git infoë¥¼ ìœ„í•´ ì „ì²´ ížˆìŠ¤í† ë¦¬ í•„ìš”

      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v4

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      # ê¸°ë³¸ ì½˜í…ì¸  ìƒì„±
      - name: Create default content
        run: |
          # About íŽ˜ì´ì§€ ìƒì„±
          mkdir -p content
          cat > content/about.md << 'EOF'
          ---
          title: "ì†Œê°œ"
          date: 2024-01-01T00:00:00+09:00
          draft: false
          ---

          # ì•ˆë…•í•˜ì„¸ìš”, Cybechoìž…ë‹ˆë‹¤! ðŸ‘‹

          ê°œë°œìžë¡œì„œì˜ ì‚½ì§ˆê³¼ ì„±ìž¥ì„ ê¸°ë¡í•˜ëŠ” ê³µê°„ìž…ë‹ˆë‹¤.

          ## ì´ ë¸”ë¡œê·¸ëŠ”...
          - ðŸ”§ ê°œë°œ ì‚½ì§ˆê¸°  
          - ðŸ“š í•™ìŠµ ë…¸íŠ¸
          - ðŸ’¡ ë¬¸ì œ í•´ê²° ê³¼ì •
          - ðŸš€ ìƒˆë¡œìš´ ê¸°ìˆ  íƒí—˜

          ì„ ë‹¤ë£¹ë‹ˆë‹¤.

          ## ì—°ë½ì²˜
          - **GitHub**: [@Cybecho](https://github.com/Cybecho)
          - **Blog**: [ì‚½ì§ˆ ì €ìž¥ì†Œ](https://cybecho.github.io)

          ---
          *"ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆ, ì‚½ì§ˆì€ ì„±ìž¥ì˜ ì•„ë²„ì§€"* âœ¨
          EOF

          # Welcome í¬ìŠ¤íŠ¸ ìƒì„±  
          mkdir -p content/posts/welcome
          cat > content/posts/welcome/index.md << 'EOF'
          ---
          title: "ðŸŽ‰ ì‚½ì§ˆ ì €ìž¥ì†Œ ì˜¤í”ˆ!"
          date: 2024-01-20T00:00:00+09:00
          draft: false
          tags: ["í™˜ì˜", "ì²«ê¸€", "ë¸”ë¡œê·¸"]
          categories: ["ê³µì§€"]
          summary: "ê°œë°œìž Cybechoì˜ ê¸°ìˆ  ë¸”ë¡œê·¸ê°€ ë“œë””ì–´ ì˜¤í”ˆí–ˆìŠµë‹ˆë‹¤!"
          ---

          # ì‚½ì§ˆ ì €ìž¥ì†Œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ðŸŽ‰

          ì•ˆë…•í•˜ì„¸ìš”! ê°œë°œìž **Cybecho**ìž…ë‹ˆë‹¤.

          ë“œë””ì–´ ì œ ê°œì¸ ê¸°ìˆ  ë¸”ë¡œê·¸ì¸ **ì‚½ì§ˆ ì €ìž¥ì†Œ**ê°€ ë¬¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.

          ## ì™œ "ì‚½ì§ˆ ì €ìž¥ì†Œ"ì¸ê°€ìš”? ðŸ¤”

          ê°œë°œì„ í•˜ë©´ì„œ ê²ªëŠ” ìˆ˜ë§Žì€ ì‹œí–‰ì°©ì˜¤ë“¤...
          - âŒ ëª‡ ì‹œê°„ ë™ì•ˆ í—¤ë§¨ ë²„ê·¸ë“¤
          - ðŸ”§ ì‚½ì§ˆ ëì— ì°¾ì€ í•´ê²°ì±…ë“¤  
          - ðŸ“š ìƒˆë¡œ ë°°ìš´ ê¸°ìˆ ê³¼ ê°œë…ë“¤
          - ðŸ’¡ "ì•„í•˜!" í•˜ëŠ” ê¹¨ë‹¬ìŒì˜ ìˆœê°„ë“¤

          ì´ëŸ° ëª¨ë“  **ì‚½ì§ˆ**ë“¤ì´ ê²°êµ­ ì„±ìž¥ì˜ ë°‘ê±°ë¦„ì´ ë©ë‹ˆë‹¤.

          ## ë‹¤ë£° ì£¼ì œë“¤ ðŸ“

          ### ðŸ–¥ï¸ ê¸°ìˆ  ìŠ¤íƒ
          - **Frontend**: React, Vue.js, TypeScript
          - **Backend**: Node.js, Python, Java  
          - **DevOps**: Docker, Kubernetes, AWS
          - **Database**: MySQL, PostgreSQL, MongoDB

          ### ðŸ“– ì½˜í…ì¸  ìœ í˜•
          - **ì‚½ì§ˆê¸°**: ì‹¤íŒ¨ì™€ ì„±ê³µì˜ ì†”ì§í•œ ê¸°ë¡
          - **í•™ìŠµ ë…¸íŠ¸**: ìƒˆë¡œ ë°°ìš´ ê¸°ìˆ  ì •ë¦¬
          - **í”„ë¡œì íŠ¸ í›„ê¸°**: ì‹¤ì œ ê²½í—˜ë‹´
          - **ë„êµ¬ ë¦¬ë·°**: ìœ ìš©í•œ ê°œë°œ ë„êµ¬ë“¤

          ## ë¸”ë¡œê·¸ ê¸°ìˆ  ìŠ¤íƒ ðŸ› ï¸

          - **CMS**: Notion (ê¸€ ìž‘ì„±)
          - **Generator**: Hugo + Lightbi Theme
          - **Hosting**: GitHub Pages  
          - **CI/CD**: GitHub Actions
          - **Domain**: cybecho.github.io

          ## ì•žìœ¼ë¡œì˜ ê³„íš ðŸš€

          - ðŸ“… **ì •ê¸° í¬ìŠ¤íŒ…**: ì£¼ 1~2íšŒ ëª©í‘œ
          - ðŸ“š **ì‹œë¦¬ì¦ˆ ì—°ìž¬**: ì‹¬í™” ì£¼ì œë“¤  
          - ðŸ”§ **ì˜¤í”ˆì†ŒìŠ¤**: ì œìž‘ ë„êµ¬ ê³µìœ 
          - ðŸ‘¥ **ì»¤ë®¤ë‹ˆí‹°**: ê°œë°œìž ë„¤íŠ¸ì›Œí‚¹

          ---

          ê¶ê¸ˆí•œ ì ì´ë‚˜ í”¼ë“œë°±ì€ ì–¸ì œë“  GitHubì„ í†µí•´ ì—°ë½ ì£¼ì„¸ìš”!

          **Happy Coding!** âœ¨
          EOF

      # Hugo ë¹Œë“œ
      - name: Build with Hugo
        env:
          HUGO_ENVIRONMENT: production
          HUGO_ENV: production
        run: |
          echo "Building Hugo site..."
          hugo --gc --minify

      # ë¹Œë“œ ê²°ê³¼ í™•ì¸
      - name: List generated files
        run: |
          echo "=== Generated files ==="
          ls -la public/
          echo "=== Pages created ==="
          find public -name "*.html" | wc -l
          echo "HTML files generated"

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
