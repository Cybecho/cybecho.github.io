name: Deploy Hugo to GitHub Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0

      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v4

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      # ðŸ” ì„¤ì • íŒŒì¼ ê²€ì¦
      - name: Validate Hugo Config
        run: |
          echo "=== Hugo Version ==="
          hugo version
          echo "=== Config Check ==="
          hugo config
          echo "=== Site Info ==="
          hugo config | grep -E "(baseurl|title|theme|author)"

      # ìƒ˜í”Œ ì½˜í…ì¸  ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)
      - name: Create sample content
        run: |
          # about íŽ˜ì´ì§€ê°€ ì—†ë‹¤ë©´ ìƒì„±
          if [ ! -f content/about.md ]; then
            mkdir -p content
            cat > content/about.md << 'EOF'
          ---
          title: "ì†Œê°œ"
          date: 2024-01-01T00:00:00+09:00
          draft: false
          ---

          # ì•ˆë…•í•˜ì„¸ìš”, Cybechoìž…ë‹ˆë‹¤! ðŸ‘‹

          ê°œë°œìžë¡œì„œì˜ ì‚½ì§ˆê³¼ ì„±ìž¥ì„ ê¸°ë¡í•˜ëŠ” ê³µê°„ìž…ë‹ˆë‹¤.

          ## ì´ ë¸”ë¡œê·¸ëŠ”...
          - ðŸ”§ ê°œë°œ ì‚½ì§ˆê¸°
          - ðŸ“š í•™ìŠµ ë…¸íŠ¸
          - ðŸ’¡ ë¬¸ì œ í•´ê²° ê³¼ì •
          - ðŸš€ ìƒˆë¡œìš´ ê¸°ìˆ  íƒí—˜

          ì„ ë‹¤ë£¹ë‹ˆë‹¤.

          **GitHub**: [@Cybecho](https://github.com/Cybecho)
          EOF
          fi

          # ì²« ë²ˆì§¸ í¬ìŠ¤íŠ¸ ìƒì„±
          if [ ! -d "content/posts" ] || [ -z "$(ls -A content/posts 2>/dev/null)" ]; then
            mkdir -p content/posts/welcome
            cat > content/posts/welcome/index.md << 'EOF'
          ---
          title: "ì‚½ì§ˆ ì €ìž¥ì†Œ ì˜¤í”ˆ!"
          date: 2024-01-20T00:00:00+09:00
          draft: false
          tags: ["í™˜ì˜", "ì²«ê¸€"]
          categories: ["ê³µì§€"]
          summary: "ê°œë°œìž Cybechoì˜ ê¸°ìˆ  ë¸”ë¡œê·¸ê°€ ë“œë””ì–´ ì˜¤í”ˆí–ˆìŠµë‹ˆë‹¤!"
          ---

          # ì‚½ì§ˆ ì €ìž¥ì†Œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ðŸŽ‰

          ì•ˆë…•í•˜ì„¸ìš”! ê°œë°œìž **Cybecho**ìž…ë‹ˆë‹¤.

          ë“œë””ì–´ ì œ ê°œì¸ ê¸°ìˆ  ë¸”ë¡œê·¸ì¸ **ì‚½ì§ˆ ì €ìž¥ì†Œ**ê°€ ë¬¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.

          ## ì™œ "ì‚½ì§ˆ ì €ìž¥ì†Œ"ì¼ê¹Œìš”? ðŸ¤”

          ê°œë°œì„ í•˜ë‹¤ ë³´ë©´ ìˆ˜ë§Žì€ **ì‹œí–‰ì°©ì˜¤**ë¥¼ ê²ªê²Œ ë©ë‹ˆë‹¤.
          
          - âŒ ëª‡ ì‹œê°„ ë™ì•ˆ í—¤ë§¨ ë²„ê·¸ë“¤
          - ðŸ”§ ì‚½ì§ˆ ëì— ì°¾ì€ í•´ê²°ì±…ë“¤  
          - ðŸ“š ìƒˆë¡œ ë°°ìš´ ê¸°ìˆ ê³¼ ê°œë…ë“¤
          - ðŸ’¡ "ì•„, ì´ë ‡ê²Œ í•˜ë©´ ë˜ëŠ”êµ¬ë‚˜!" ìˆœê°„ë“¤

          ì´ëŸ° ëª¨ë“  **ì‚½ì§ˆ**ë“¤ì´ ê²°êµ­ ì„±ìž¥ì˜ ë°‘ê±°ë¦„ì´ ëœë‹¤ê³  ìƒê°í•´ìš”.
          ê·¸ëž˜ì„œ ì´ ë¸”ë¡œê·¸ ì´ë¦„ì„ **"ì‚½ì§ˆ ì €ìž¥ì†Œ"**ë¼ê³  ì§€ì—ˆìŠµë‹ˆë‹¤.

          ## ì–´ë–¤ ë‚´ìš©ì„ ë‹¤ë£° ì˜ˆì •ì¸ê°€ìš”? ðŸ“

          ### ðŸ–¥ï¸ ê¸°ìˆ  ìŠ¤íƒ
          - **Frontend**: React, Vue.js, TypeScript
          - **Backend**: Node.js, Python, Java
          - **DevOps**: Docker, Kubernetes, AWS
          - **Database**: MySQL, PostgreSQL, MongoDB

          ### ðŸ“– ì½˜í…ì¸  ìœ í˜•
          - **ì‚½ì§ˆê¸°**: ì‹¤íŒ¨ì™€ ì„±ê³µì˜ ì†”ì§í•œ ê¸°ë¡
          - **í•™ìŠµ ë…¸íŠ¸**: ìƒˆë¡œ ë°°ìš´ ê¸°ìˆ  ì •ë¦¬
          - **í”„ë¡œì íŠ¸ í›„ê¸°**: ê°œì¸/íšŒì‚¬ í”„ë¡œì íŠ¸ ê²½í—˜ë‹´
          - **ë„êµ¬ ë¦¬ë·°**: ìœ ìš©í•œ ê°œë°œ ë„êµ¬ë“¤ ì†Œê°œ

          ## ë¸”ë¡œê·¸ ê¸°ìˆ  ìŠ¤íƒ ðŸ› ï¸

          ì´ ë¸”ë¡œê·¸ëŠ” ë‹¤ìŒ ê¸°ìˆ ë“¤ë¡œ êµ¬ì„±ë˜ì–´ ìžˆì–´ìš”:

          - **CMS**: Notion (ê¸€ ìž‘ì„±)
          - **Static Site Generator**: Hugo
          - **Theme**: Lightbi (ê¹”ë”í•œ ë””ìžì¸!)
          - **Hosting**: GitHub Pages
          - **CI/CD**: GitHub Actions
          - **Domain**: cybecho.github.io

          Notionì—ì„œ ê¸€ì„ ìž‘ì„±í•˜ë©´ GitHub Actionsê°€ ìžë™ìœ¼ë¡œ Hugo ì‚¬ì´íŠ¸ë¥¼ ë¹Œë“œí•˜ê³  ë°°í¬í•˜ëŠ” êµ¬ì¡°ìž…ë‹ˆë‹¤!

          ## ì•žìœ¼ë¡œì˜ ê³„íš ðŸš€

          - **ì •ê¸°ì ì¸ í¬ìŠ¤íŒ…**: ì£¼ 1~2íšŒ ëª©í‘œ
          - **ì‹œë¦¬ì¦ˆ ì—°ìž¬**: ì‹¬ë„ ìžˆëŠ” ì£¼ì œë“¤ì„ ì—°ìž¬ë¡œ
          - **ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬**: ì œê°€ ë§Œë“  ë„êµ¬ë“¤ ê³µìœ 
          - **ì»¤ë®¤ë‹ˆí‹° í™œë™**: ê°œë°œ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ í›„ê¸°

          ## ë§ˆë¬´ë¦¬ ðŸ’¬

          ì•„ì§ ë¶€ì¡±í•œ ë¶€ë¶„ì´ ë§Žì§€ë§Œ, ê¾¸ì¤€ížˆ ê¸°ë¡í•˜ê³  ê³µìœ í•˜ë©° í•¨ê»˜ ì„±ìž¥í•˜ëŠ” ê³µê°„ì´ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ì–´ìš”.

          ê¶ê¸ˆí•œ ì ì´ë‚˜ í”¼ë“œë°±ì´ ìžˆìœ¼ì‹œë©´ ì–¸ì œë“  GitHubë¥¼ í†µí•´ ì—°ë½ ì£¼ì„¸ìš”!

          **Happy Coding!** âœ¨

          ---
          
          **ì—°ë½ì²˜**:
          - GitHub: [@Cybecho](https://github.com/Cybecho)
          - Blog: [ì‚½ì§ˆ ì €ìž¥ì†Œ](https://cybecho.github.io)
          EOF
          fi

      # Hugo ë¹Œë“œ
      - name: Build with Hugo
        env:
          HUGO_ENVIRONMENT: production
          HUGO_ENV: production
        run: |
          echo "Building with Hugo..."
          hugo --gc --minify

      # ë¹Œë“œ ê²°ê³¼ í™•ì¸
      - name: List generated files
        run: |
          echo "=== Generated files ==="
          ls -la public/
          echo "=== HTML pages ==="
          find public -name "*.html" | wc -l
          echo "total HTML files"

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
