---
title: "현대 분산 환경에서는 TCP_NODELAY을 끄라고한다 근데 이게 뭔데?"
date: 2025-12-26T00:00:00.000Z
draft: false
tags: ["Infra"]
series: ["Infra & Network"]
description: "과거의 네이글 알고리즘은 작은 패킷 전송으로 인한 지연 문제를 해결했지만, 현대의 빠른 네트워크 환경에서는 오히려 성능 저하의 원인이 된다. 현재는 TCP_NODELAY 설정을 활성화하여 즉시 데이터를 전송하는 것이 바람직하며, 애플리케이션 계층에서 적절한 버퍼링을 통해 효율성을 높이는 것이 중요하다. 과거의 최적화 기법이 현대에는 장애물이 될 수 있음을 강조한다."
notion_id: "2d51bab9-e3f8-813f-a5b1-e8ccfede48aa"
notion_url: "https://www.notion.so/TCP_NODELAY-2d51bab9e3f8813fa5b1e8ccfede48aa"
---

# 현대 분산 환경에서는 TCP_NODELAY을 끄라고한다 근데 이게 뭔데?

> **Summary**
> 과거의 네이글 알고리즘은 작은 패킷 전송으로 인한 지연 문제를 해결했지만, 현대의 빠른 네트워크 환경에서는 오히려 성능 저하의 원인이 된다. 현재는 TCP_NODELAY 설정을 활성화하여 즉시 데이터를 전송하는 것이 바람직하며, 애플리케이션 계층에서 적절한 버퍼링을 통해 효율성을 높이는 것이 중요하다. 과거의 최적화 기법이 현대에는 장애물이 될 수 있음을 강조한다.

---

![Image](image_9b7a9663e70a.png)

## **1. 배경: 1984년, 인터넷 초창기의 '낭비' 문제**

인터넷 초창기에는 네트워크 대역폭이 매우 귀하고 느렸습니다. 당시 텔넷(Telnet) 같은 서비스로 원격 컴퓨터에 접속할 때, 사용자가 키보드를 한 글자 칠 때마다 패킷이 하나씩 전송되었습니다.

**문제점:** 1바이트 데이터를 보내기 위해 TCP 헤더 20바이트와 IP 헤더 20바이트, 총 40바이트의 '봉투'가 필요했습니다. 배보다 배꼽이 훨씬 컸고, 이런 작은 패킷들이 네트워크를 가득 채워 정체를 유발했습니다.

**존 네이글의 해결책:** "이전 데이터에 대한 확인 응답(ACK)이 올 때까지 기다리거나, 보낼 데이터가 충분히 모일 때까지 기다렸다가 한꺼번에 보내자." 이것이 바로 네이글 알고리즘입니다.

## **2. 논리적 충돌: 두 가지 '효율'의 악마적 만남**

네이글 알고리즘은 훌륭했지만, 시간이 흐르며 또 다른 효율화 기술인 **지연된 확인 응답(Delayed ACK)**이 등장하면서 문제가 시작되었습니다.

**네이글 알고리즘(송신측):** "확인(ACK)이 올 때까지 다음 데이터는 보내지 않겠다."

**지연된 ACK(수신측):** "받을 때마다 확인을 보내는 건 낭비다. 잠시 기다렸다가 다른 데이터와 묶어서 보내거나 나중에 보내겠다."

여기서 **논리적 교착 상태(Deadlock)**가 발생합니다. 송신측은 확인을 기다리고, 수신측은 확인을 늦게 보냅니다. 이 지연 시간은 최대 200ms(0.2초)에 달하는데, 수천 번 통신하는 현대 시스템에서는 엄청난 지연을 유발합니다.

## **3. 현대 환경: 과거의 유산이 걸림돌이 된 이유**

과거에는 네트워크가 느려 '효율'이 중요했지만, 현대는 상황이 완전히 바뀌었습니다.

**충분한 속도:** 데이터센터 내부나 현대 광랜 환경에서는 왕복 시간(RTT)이 매우 짧습니다. 네트워크가 빠르기 때문에 데이터를 모아서 보낼 필요가 없습니다.

**큰 데이터:** 현대 통신(TLS 암호화, 데이터 직렬화 등)은 기본적으로 데이터 크기가 큽니다. 과거처럼 1바이트 패킷을 걱정할 일이 거의 없습니다.

**실시간성 강조:** 게임, 금융 거래, 마이크로서비스 간 통신 등 현대 앱은 0.1초의 지연도 허용하지 않는 경우가 많습니다.

## **4. 결론: "항상 TCP_NODELAY를 켜라"**

오늘날 많은 전문가들은 네이글 알고리즘을 비활성화하는 TCP_NODELAY=1 설정을 기본값으로 사용해야 한다고 주장합니다.

**논리:** 운영체제가 임의로 데이터를 붙잡아두지 않게 하고, 애플리케이션이 데이터를 보내는 즉시 네트워크로 전송하는 것이 현대 시스템 설계의 상식입니다.

**대안:** 패킷을 묶어서 효율적으로 보내고 싶다면, 운영체제에 맡기기보다 애플리케이션 계층에서 적절히 버퍼링해서 한 번에 큰 덩어리를 보내는 것이 훨씬 예측 가능하고 성능에 유리합니다.

**핵심 메시지:** 과거의 훌륭했던 최적화 기법이 현대에는 오히려 성능을 갉아먹는 장애물이 되었습니다. 지연 시간을 줄이기 위해 TCP_NODELAY 설정을 반드시 확인해야 합니다.

